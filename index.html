<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bowler Chart Tracker - Scenthound</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 100%;
            margin: 0;
            padding: 0;
            background: #f8f8f8;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 0;
            box-shadow: none;
            max-width: 100%;
            margin: 0;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #00A0DC 0%, #0077B6 100%);
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 40px;
            text-align: center;
        }

        h1 {
            margin: 0;
            font-size: 2.2em;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
            font-weight: 400;
            margin-top: 5px;
        }

        .btn {
            background: linear-gradient(135deg, #00A0DC 0%, #0077B6 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-family: 'Poppins', sans-serif;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 160, 220, 0.3);
        }

        .btn-secondary {
            background: #FF6B35;
        }

        .btn-secondary:hover {
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        .btn-cancel {
            background: #999;
        }

        .btn-cancel:hover {
            background: #777;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .form-box {
            background: #f0f9ff;
            border-left: 5px solid #00A0DC;
            padding: 30px;
            margin: 30px 0;
            border-radius: 8px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: #0077B6;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-family: 'Poppins', sans-serif;
            font-size: 1em;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #00A0DC;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .view-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .tab {
            padding: 12px 24px;
            border-radius: 8px;
            border: 2px solid #00A0DC;
            background: white;
            color: #00A0DC;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Poppins', sans-serif;
        }

        .tab:hover {
            background: #e6f7ff;
        }

        .tab.active {
            background: linear-gradient(135deg, #00A0DC 0%, #0077B6 100%);
            color: white;
            border-color: #0077B6;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .data-table thead {
            background: linear-gradient(135deg, #00A0DC 0%, #0077B6 100%);
            color: white;
        }

        .data-table th {
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9em;
        }

        .data-table th.text-right {
            text-align: right;
        }

        .data-table th.highlight {
            background: #0077B6;
        }

        .data-table th.conversion {
            background: #FF6B35;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-table td.text-right {
            text-align: right;
        }

        .data-table tbody tr:hover {
            background: #f0f9ff;
        }

        .data-table td.highlight {
            background: #f0f9ff;
            font-weight: 600;
        }

        .data-table td.conversion {
            background: #fff8f0;
            font-weight: 600;
            color: #FF6B35;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
            transition: background 0.2s;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .info-note {
            background: #fff8f0;
            border-left: 4px solid #FF6B35;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            font-size: 0.95em;
        }

        .info-note strong {
            color: #FF6B35;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .data-table {
                font-size: 0.85em;
            }

            .data-table th,
            .data-table td {
                padding: 8px 6px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const BowlerTracker = () => {
            const [entries, setEntries] = useState([]);
            const [showForm, setShowForm] = useState(false);
            const [loading, setLoading] = useState(true);
            const [view, setView] = useState('daily');
            const [locationFilter, setLocationFilter] = useState('All Scenters');
            const [currentEntry, setCurrentEntry] = useState({
                date: new Date().toISOString().split('T')[0],
                location: 'Cedar Mill',
                newLeads: 0,
                activeTrialLeads: 0,
                texted: 0,
                called: 0,
                bookedPhone: 0,
                bookedText: 0,
                comments: ''
            });
            
            const locations = ['Cedar Mill', 'Tigard', 'Hillsboro', 'Sherwood'];

            useEffect(() => {
                try {
                    const saved = localStorage.getItem('bowler-entries');
                    if (saved) {
                        setEntries(JSON.parse(saved));
                    }
                } catch (error) {
                    console.log('No existing data found, starting fresh');
                }
                setLoading(false);
            }, []);

            useEffect(() => {
                if (!loading) {
                    try {
                        localStorage.setItem('bowler-entries', JSON.stringify(entries));
                    } catch (error) {
                        console.error('Error saving data:', error);
                    }
                }
            }, [entries, loading]);

            const handleInputChange = (field, value) => {
                setCurrentEntry(prev => ({
                    ...prev,
                    [field]: field === 'comments' ? value : (parseInt(value) || 0)
                }));
            };

            const addEntry = () => {
                setEntries(prev => [...prev, currentEntry].sort((a, b) => 
                    new Date(b.date) - new Date(a.date)
                ));
                setCurrentEntry({
                    date: new Date().toISOString().split('T')[0],
                    location: 'Cedar Mill',
                    newLeads: 0,
                    activeTrialLeads: 0,
                    texted: 0,
                    called: 0,
                    bookedPhone: 0,
                    bookedText: 0,
                    comments: ''
                });
                setShowForm(false);
            };

            const deleteEntry = (index) => {
                if (confirm('Are you sure you want to delete this entry?')) {
                    setEntries(prev => prev.filter((_, i) => i !== index));
                }
            };

            const getWeekNumber = (date) => {
                const d = new Date(date);
                d.setHours(0, 0, 0, 0);
                d.setDate(d.getDate() + 4 - (d.getDay() || 7));
                const yearStart = new Date(d.getFullYear(), 0, 1);
                return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            };

            const getMonthYear = (date) => {
                const d = new Date(date);
                return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
            };

            const calculateTotals = (entriesSubset) => {
                return entriesSubset.reduce((acc, entry) => ({
                    newLeads: acc.newLeads + entry.newLeads,
                    activeTrialLeads: acc.activeTrialLeads + entry.activeTrialLeads,
                    texted: acc.texted + entry.texted,
                    called: acc.called + entry.called,
                    bookedPhone: acc.bookedPhone + entry.bookedPhone,
                    bookedText: acc.bookedText + entry.bookedText,
                    totalContacted: acc.totalContacted + entry.texted + entry.called,
                    totalBooked: acc.totalBooked + entry.bookedPhone + entry.bookedText
                }), {
                    newLeads: 0,
                    activeTrialLeads: 0,
                    texted: 0,
                    called: 0,
                    bookedPhone: 0,
                    bookedText: 0,
                    totalContacted: 0,
                    totalBooked: 0
                });
            };

            const weeklyData = () => {
                const weeks = {};
                const filteredEntries = locationFilter === 'All Scenters' 
                    ? entries 
                    : entries.filter(e => e.location === locationFilter);
                    
                filteredEntries.forEach(entry => {
                    const week = `${new Date(entry.date).getFullYear()}-W${getWeekNumber(entry.date)}`;
                    if (!weeks[week]) weeks[week] = [];
                    weeks[week].push(entry);
                });
                return Object.entries(weeks).map(([week, entries]) => ({
                    period: week,
                    ...calculateTotals(entries)
                })).sort((a, b) => b.period.localeCompare(a.period));
            };

            const monthlyData = () => {
                const months = {};
                const filteredEntries = locationFilter === 'All Scenters' 
                    ? entries 
                    : entries.filter(e => e.location === locationFilter);
                    
                filteredEntries.forEach(entry => {
                    const month = getMonthYear(entry.date);
                    if (!months[month]) months[month] = [];
                    months[month].push(entry);
                });
                return Object.entries(months).map(([month, entries]) => ({
                    period: new Date(month + '-01').toLocaleDateString('en-US', { year: 'numeric', month: 'long' }),
                    ...calculateTotals(entries)
                })).sort((a, b) => b.period.localeCompare(a.period));
            };

            const yearlyData = () => {
                const years = {};
                const filteredEntries = locationFilter === 'All Scenters' 
                    ? entries 
                    : entries.filter(e => e.location === locationFilter);
                    
                filteredEntries.forEach(entry => {
                    const year = new Date(entry.date).getFullYear().toString();
                    if (!years[year]) years[year] = [];
                    years[year].push(entry);
                });
                return Object.entries(years).map(([year, entries]) => ({
                    period: year,
                    ...calculateTotals(entries)
                })).sort((a, b) => b.period.localeCompare(a.period));
            };
            
            const getFilteredEntries = () => {
                if (locationFilter === 'All Scenters') return entries;
                return entries.filter(e => e.location === locationFilter);
            };

            const exportToCSV = () => {
                // Individual entries
                const headers = 'Date,Location,New Leads,Active Trial Leads,Texted,Called,Total Contacted,Booked Phone,Booked Text,Total Booked,Comments\n';
                const rows = entries.map(e => 
                    `${e.date},${e.location},${e.newLeads},${e.activeTrialLeads},${e.texted},${e.called},${e.texted + e.called},${e.bookedPhone},${e.bookedText},${e.bookedPhone + e.bookedText},"${(e.comments || '').replace(/"/g, '""')}"`
                ).join('\n');
                
                // Aggregate by date for "All Locations"
                const byDate = {};
                entries.forEach(e => {
                    if (!byDate[e.date]) {
                        byDate[e.date] = {
                            newLeads: 0,
                            activeTrialLeads: 0,
                            texted: 0,
                            called: 0,
                            bookedPhone: 0,
                            bookedText: 0
                        };
                    }
                    byDate[e.date].newLeads += e.newLeads;
                    byDate[e.date].activeTrialLeads += e.activeTrialLeads;
                    byDate[e.date].texted += e.texted;
                    byDate[e.date].called += e.called;
                    byDate[e.date].bookedPhone += e.bookedPhone;
                    byDate[e.date].bookedText += e.bookedText;
                });
                
                const aggregatedRows = Object.entries(byDate)
                    .sort(([dateA], [dateB]) => new Date(dateB) - new Date(dateA))
                    .map(([date, data]) => 
                        `${date},All Locations,${data.newLeads},${data.activeTrialLeads},${data.texted},${data.called},${data.texted + data.called},${data.bookedPhone},${data.bookedText},${data.bookedPhone + data.bookedText},""`
                    ).join('\n');
                
                // Combine with separator
                const csvContent = headers + rows + '\n\n' + aggregatedRows;
                
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'bowler_chart_data.csv';
                a.click();
            };

            if (loading) {
                return <div className="container">Loading...</div>;
            }

            return (
                <div className="container">
                    <div className="header">
                        <h1>üêæ LEASH BOWLER CHART TRACKER üêæ</h1>
                        <div className="subtitle">Daily Performance Tracking by Scenter Location</div>
                    </div>

                    <div className="info-note">
                        <strong>üí° Pro Tip:</strong> Your data is automatically saved and persists across sessions. Export to CSV regularly for backup and reporting in Google Sheets or Excel.
                    </div>

                    <div className="controls">
                        <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap' }}>
                            <button onClick={() => setShowForm(!showForm)} className="btn">
                                {showForm ? '‚úñ Cancel' : '+ Add Daily Entry'}
                            </button>
                            {entries.length > 0 && (
                                <button onClick={exportToCSV} className="btn btn-secondary">
                                    ‚¨á Export to CSV
                                </button>
                            )}
                        </div>
                    </div>

                    {showForm && (
                        <div className="form-box">
                            <h2 style={{ color: '#0077B6', marginTop: 0, marginBottom: 20 }}>üìÖ New Daily Entry</h2>
                            <div className="form-grid">
                                <div>
                                    <label className="form-label">Date</label>
                                    <input
                                        type="date"
                                        value={currentEntry.date}
                                        onChange={(e) => setCurrentEntry(prev => ({ ...prev, date: e.target.value }))}
                                        className="form-input"
                                    />
                                </div>
                                <div>
                                    <label className="form-label">Scenter Location</label>
                                    <select
                                        value={currentEntry.location}
                                        onChange={(e) => setCurrentEntry(prev => ({ ...prev, location: e.target.value }))}
                                        className="form-input"
                                    >
                                        {locations.map(loc => (
                                            <option key={loc} value={loc}>{loc}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="form-label">New Leads</label>
                                    <input
                                        type="number"
                                        value={currentEntry.newLeads}
                                        onChange={(e) => handleInputChange('newLeads', e.target.value)}
                                        className="form-input"
                                    />
                                </div>
                                <div>
                                    <label className="form-label">Active Trial Leads</label>
                                    <input
                                        type="number"
                                        value={currentEntry.activeTrialLeads}
                                        onChange={(e) => handleInputChange('activeTrialLeads', e.target.value)}
                                        className="form-input"
                                    />
                                </div>
                                <div>
                                    <label className="form-label">Texted</label>
                                    <input
                                        type="number"
                                        value={currentEntry.texted}
                                        onChange={(e) => handleInputChange('texted', e.target.value)}
                                        className="form-input"
                                    />
                                </div>
                                <div>
                                    <label className="form-label">Called</label>
                                    <input
                                        type="number"
                                        value={currentEntry.called}
                                        onChange={(e) => handleInputChange('called', e.target.value)}
                                        className="form-input"
                                    />
                                </div>
                                <div>
                                    <label className="form-label">Booked (Phone)</label>
                                    <input
                                        type="number"
                                        value={currentEntry.bookedPhone}
                                        onChange={(e) => handleInputChange('bookedPhone', e.target.value)}
                                        className="form-input"
                                    />
                                </div>
                                <div>
                                    <label className="form-label">Booked (Text)</label>
                                    <input
                                        type="number"
                                        value={currentEntry.bookedText}
                                        onChange={(e) => handleInputChange('bookedText', e.target.value)}
                                        className="form-input"
                                    />
                                </div>
                            </div>
                            <div style={{ marginTop: '20px' }}>
                                <label className="form-label">Comments / Notes</label>
                                <textarea
                                    value={currentEntry.comments}
                                    onChange={(e) => handleInputChange('comments', e.target.value)}
                                    className="form-input"
                                    rows="3"
                                    placeholder="e.g., John Doe - requested callback tomorrow; Jane Smith - unreachable phone number"
                                    style={{ resize: 'vertical' }}
                                />
                                <p style={{ fontSize: '0.85em', color: '#666', marginTop: '5px' }}>
                                    Note any leads/active trials not contacted and why (requested callback, bad number, etc.)
                                </p>
                            </div>
                            <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                                <button onClick={addEntry} className="btn">
                                    ‚úì Save Entry
                                </button>
                                <button onClick={() => setShowForm(false)} className="btn btn-cancel">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    )}

                    <div className="view-tabs">
                        <button
                            onClick={() => setView('daily')}
                            className={`tab ${view === 'daily' ? 'active' : ''}`}
                        >
                            Daily View
                        </button>
                        <button
                            onClick={() => setView('weekly')}
                            className={`tab ${view === 'weekly' ? 'active' : ''}`}
                        >
                            Weekly View
                        </button>
                        <button
                            onClick={() => setView('monthly')}
                            className={`tab ${view === 'monthly' ? 'active' : ''}`}
                        >
                            Monthly View
                        </button>
                        <button
                            onClick={() => setView('yearly')}
                            className={`tab ${view === 'yearly' ? 'active' : ''}`}
                        >
                            Yearly View
                        </button>
                    </div>

                    <div style={{ marginBottom: '20px' }}>
                        <label className="form-label">Filter by Location:</label>
                        <select
                            value={locationFilter}
                            onChange={(e) => setLocationFilter(e.target.value)}
                            className="form-input"
                            style={{ maxWidth: '300px' }}
                        >
                            <option value="All Scenters">All Scenters (Combined)</option>
                            {locations.map(loc => (
                                <option key={loc} value={loc}>{loc}</option>
                            ))}
                        </select>
                    </div>

                    {entries.length === 0 ? (
                        <div className="empty-state">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <h2 style={{ color: '#00A0DC' }}>No Entries Yet</h2>
                            <p style={{ fontSize: '1.1em' }}>Click "Add Daily Entry" to start tracking your performance!</p>
                        </div>
                    ) : (
                        <div style={{ overflowX: 'auto' }}>
                            <table className="data-table">
                                <thead>
                                    <tr>
                                        <th>{view === 'daily' ? 'Date' : 'Period'}</th>
                                        <th>Location</th>
                                        <th className="text-right">New Leads</th>
                                        <th className="text-right">Active Trial</th>
                                        <th className="text-right">Texted</th>
                                        <th className="text-right">Called</th>
                                        <th className="text-right highlight">Total Contacted</th>
                                        <th className="text-right">Phone</th>
                                        <th className="text-right">Text</th>
                                        <th className="text-right highlight">Total Booked</th>
                                        {view === 'daily' && <th>Comments</th>}
                                        {view === 'daily' && <th>Actions</th>}
                                    </tr>
                                </thead>
                                <tbody>
                                    {view === 'daily' && getFilteredEntries().map((entry, idx) => (
                                        <tr key={idx}>
                                            <td>{new Date(entry.date).toLocaleDateString()}</td>
                                            <td><strong>{entry.location}</strong></td>
                                            <td className="text-right">{entry.newLeads}</td>
                                            <td className="text-right">{entry.activeTrialLeads}</td>
                                            <td className="text-right">{entry.texted}</td>
                                            <td className="text-right">{entry.called}</td>
                                            <td className="text-right highlight">
                                                {entry.texted + entry.called}
                                            </td>
                                            <td className="text-right">{entry.bookedPhone}</td>
                                            <td className="text-right">{entry.bookedText}</td>
                                            <td className="text-right highlight">
                                                {entry.bookedPhone + entry.bookedText}
                                            </td>
                                            <td style={{ fontSize: '0.85em', maxWidth: '200px' }}>{entry.comments || '-'}</td>
                                            <td>
                                                <button onClick={() => deleteEntry(idx)} className="delete-btn">
                                                    üóë Delete
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                    {view === 'weekly' && weeklyData().map((week, idx) => (
                                        <tr key={idx}>
                                            <td style={{ fontWeight: 600 }}>{week.period}</td>
                                            <td><em>{locationFilter}</em></td>
                                            <td className="text-right">{week.newLeads}</td>
                                            <td className="text-right">{week.activeTrialLeads}</td>
                                            <td className="text-right">{week.texted}</td>
                                            <td className="text-right">{week.called}</td>
                                            <td className="text-right highlight">{week.totalContacted}</td>
                                            <td className="text-right">{week.bookedPhone}</td>
                                            <td className="text-right">{week.bookedText}</td>
                                            <td className="text-right highlight">{week.totalBooked}</td>
                                        </tr>
                                    ))}
                                    {view === 'monthly' && monthlyData().map((month, idx) => (
                                        <tr key={idx}>
                                            <td style={{ fontWeight: 600 }}>{month.period}</td>
                                            <td><em>{locationFilter}</em></td>
                                            <td className="text-right">{month.newLeads}</td>
                                            <td className="text-right">{month.activeTrialLeads}</td>
                                            <td className="text-right">{month.texted}</td>
                                            <td className="text-right">{month.called}</td>
                                            <td className="text-right highlight">{month.totalContacted}</td>
                                            <td className="text-right">{month.bookedPhone}</td>
                                            <td className="text-right">{month.bookedText}</td>
                                            <td className="text-right highlight">{month.totalBooked}</td>
                                        </tr>
                                    ))}
                                    {view === 'yearly' && yearlyData().map((year, idx) => (
                                        <tr key={idx}>
                                            <td style={{ fontWeight: 600 }}>{year.period}</td>
                                            <td><em>{locationFilter}</em></td>
                                            <td className="text-right">{year.newLeads}</td>
                                            <td className="text-right">{year.activeTrialLeads}</td>
                                            <td className="text-right">{year.texted}</td>
                                            <td className="text-right">{year.called}</td>
                                            <td className="text-right highlight">{year.totalContacted}</td>
                                            <td className="text-right">{year.bookedPhone}</td>
                                            <td className="text-right">{year.bookedText}</td>
                                            <td className="text-right highlight">{year.totalBooked}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}

                    <div style={{ textAlign: 'center', padding: '40px 20px', color: '#0077B6', marginTop: '40px' }}>
                        <span style={{ color: '#FF6B35', fontSize: '1.5em' }}>üêæ</span>
                        <strong> SCENTHOUND</strong> - Making dog care routine, affordable, and accessible
                        <span style={{ color: '#FF6B35', fontSize: '1.5em' }}> üêæ</span>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<BowlerTracker />, document.getElementById('root'));
    </script>
</body>
</html>
