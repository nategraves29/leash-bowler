<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bowler Chart Tracker - Scenthound</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 100%;
            margin: 0;
            padding: 0;
            background: #f8f8f8;
        }

        .container {
            background: white;
            padding: 50px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 100%;
            margin: 20px;
        }

        .header {
            background: linear-gradient(135deg, #00A0DC 0%, #0077B6 100%);
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 40px;
            text-align: center;
        }

        h1 {
            margin: 0;
            font-size: 2.2em;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
            font-weight: 400;
            margin-top: 5px;
        }

        .btn {
            background: linear-gradient(135deg, #00A0DC 0%, #0077B6 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-family: 'Poppins', sans-serif;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 160, 220, 0.3);
        }

        .btn-secondary {
            background: #FF6B35;
        }

        .btn-secondary:hover {
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        .btn-cancel {
            background: #999;
        }

        .btn-cancel:hover {
            background: #777;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .form-box {
            background: #f0f9ff;
            border-left: 5px solid #00A0DC;
            padding: 30px;
            margin: 30px 0;
            border-radius: 8px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: #0077B6;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-family: 'Poppins', sans-serif;
            font-size: 1em;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #00A0DC;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .view-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .tab {
            padding: 12px 24px;
            border-radius: 8px;
            border: 2px solid #00A0DC;
            background: white;
            color: #00A0DC;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Poppins', sans-serif;
        }

        .tab:hover {
            background: #e6f7ff;
        }

        .tab.active {
            background: linear-gradient(135deg, #00A0DC 0%, #0077B6 100%);
            color: white;
            border-color: #0077B6;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .data-table thead {
            background: linear-gradient(135deg, #00A0DC 0%, #0077B6 100%);
            color: white;
        }

        .data-table th {
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9em;
        }

        .data-table th.text-right {
            text-align: right;
        }

        .data-table th.highlight {
            background: #0077B6;
        }

        .data-table th.conversion {
            background: #FF6B35;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-table td.text-right {
            text-align: right;
        }

        .data-table tbody tr:hover {
            background: #f0f9ff;
        }

        .data-table td.highlight {
            background: #f0f9ff;
            font-weight: 600;
        }

        .data-table td.conversion {
            background: #fff8f0;
            font-weight: 600;
            color: #FF6B35;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .info-note {
            background: #fff8f0;
            border-left: 4px solid #FF6B35;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            font-size: 0.95em;
        }

        .info-note strong {
            color: #FF6B35;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .data-table {
                font-size: 0.85em;
            }

            .data-table th,
            .data-table td {
                padding: 8px 6px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const BowlerTracker = () => {
            const [entries, setEntries] = useState([]);
            const [showForm, setShowForm] = useState(false);
            const [loading, setLoading] = useState(true);
            const [view, setView] = useState('daily');
            const [currentEntry, setCurrentEntry] = useState({
                date: new Date().toISOString().split('T')[0],
                newLeads: 0,
                activeTrialLeads: 0,
                texted: 0,
                called: 0,
                bookedPhone: 0,
                bookedText: 0,
                conversions: 0
            });

            useEffect(() => {
                const loadData = async () => {
                    try {
                        const result = await window.storage.get('bowler-entries');
                        if (result && result.value) {
                            setEntries(JSON.parse(result.value));
                        }
                    } catch (error) {
                        console.log('No existing data found, starting fresh');
                    } finally {
                        setLoading(false);
                    }
                };
                loadData();
            }, []);

            useEffect(() => {
                if (!loading && entries.length > 0) {
                    const saveData = async () => {
                        try {
                            await window.storage.set('bowler-entries', JSON.stringify(entries));
                        } catch (error) {
                            console.error('Error saving data:', error);
                        }
                    };
                    saveData();
                }
            }, [entries, loading]);

            const handleInputChange = (field, value) => {
                setCurrentEntry(prev => ({
                    ...prev,
                    [field]: parseInt(value) || 0
                }));
            };

            const addEntry = () => {
                setEntries(prev => [...prev, currentEntry].sort((a, b) => 
                    new Date(b.date) - new Date(a.date)
                ));
                setCurrentEntry({
                    date: new Date().toISOString().split('T')[0],
                    newLeads: 0,
                    activeTrialLeads: 0,
                    texted: 0,
                    called: 0,
                    bookedPhone: 0,
                    bookedText: 0,
                    conversions: 0
                });
                setShowForm(false);
            };

            const getWeekNumber = (date) => {
                const d = new Date(date);
                d.setHours(0, 0, 0, 0);
                d.setDate(d.getDate() + 4 - (d.getDay() || 7));
                const yearStart = new Date(d.getFullYear(), 0, 1);
                return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            };

            const getMonthYear = (date) => {
                const d = new Date(date);
                return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
            };

            const calculateTotals = (entriesSubset) => {
                return entriesSubset.reduce((acc, entry) => ({
                    newLeads: acc.newLeads + entry.newLeads,
                    activeTrialLeads: acc.activeTrialLeads + entry.activeTrialLeads,
                    texted: acc.texted + entry.texted,
                    called: acc.called + entry.called,
                    bookedPhone: acc.bookedPhone + entry.bookedPhone,
                    bookedText: acc.bookedText + entry.bookedText,
                    conversions: acc.conversions + entry.conversions,
                    totalContacted: acc.totalContacted + entry.newLeads + entry.activeTrialLeads,
                    totalBooked: acc.totalBooked + entry.bookedPhone + entry.bookedText
                }), {
                    newLeads: 0,
                    activeTrialLeads: 0,
                    texted: 0,
                    called: 0,
                    bookedPhone: 0,
                    bookedText: 0,
                    conversions: 0,
                    totalContacted: 0,
                    totalBooked: 0
                });
            };

            const weeklyData = () => {
                const weeks = {};
                entries.forEach(entry => {
                    const week = `${new Date(entry.date).getFullYear()}-W${getWeekNumber(entry.date)}`;
                    if (!weeks[week]) weeks[week] = [];
                    weeks[week].push(entry);
                });
                return Object.entries(weeks).map(([week, entries]) => ({
                    period: week,
                    ...calculateTotals(entries)
                })).sort((a, b) => b.period.localeCompare(a.period));
            };

            const monthlyData = () => {
                const months = {};
                entries.forEach(entry => {
                    const month = getMonthYear(entry.date);
                    if (!months[month]) months[month] = [];
                    months[month].push(entry);
                });
                return Object.entries(months).map(([month, entries]) => ({
                    period: new Date(month + '-01').toLocaleDateString('en-US', { year: 'numeric', month: 'long' }),
                    ...calculateTotals(entries)
                })).sort((a, b) => b.period.localeCompare(a.period));
            };

            const exportToCSV = () => {
                const headers = 'Date,New Leads,Active Trial Leads,Texted,Called,Total Contacted,Booked Phone,Booked Text,Total Booked,Conversions\n';
                const rows = entries.map(e => 
                    `${e.date},${e.newLeads},${e.activeTrialLeads},${e.texted},${e.called},${e.newLeads + e.activeTrialLeads},${e.bookedPhone},${e.bookedText},${e.bookedPhone + e.bookedText},${e.conversions}`
                ).join('\n');
                
                const blob = new Blob([headers + rows], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'bowler_chart_data.csv';
                a.click();
            };

            if (loading) {
                return <div className="container">Loading...</div>;
            }

            return (
                <div className="container">
                    <div className="header">
                        <h1>üêæ BOWLER CHART TRACKER</h1>
                        <div className="subtitle">Daily Performance Tracking Across All 3 Scenters</div>
                    </div>

                    <div className="info-note">
                        <strong>üí° Pro Tip:</strong> Your data is automatically saved and persists across sessions. Export to CSV regularly for backup and reporting in Google Sheets or Excel.
                    </div>

                    <div className="controls">
                        <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap' }}>
                            <button onClick={() => setShowForm(!showForm)} className="btn">
                                {showForm ? '‚úñ Cancel' : '+ Add Daily Entry'}
                            </button>
                            {entries.length > 0 && (
                                <button onClick={exportToCSV} className="btn btn-secondary">
                                    ‚¨á Export to CSV
                                </button>
                            )}
                        </div>
                    </div>

                    {showForm && (
                        <div className="form-box">
                            <h2 style={{ color: '#0077B6', marginTop: 0, marginBottom: 20 }}>üìÖ New Daily Entry</h2>
                            <div className="form-grid">
                                <div>
                                    <label className="form-label">Date</label>
                                    <input
                                        type="date"
                                        value={currentEntry.date}
                                        onChange={(e) => setCurrentEntry(prev => ({ ...prev, date: e.target.value }))}
                                        className="form-input"
                                    />
                                </div>
                                <div>
                                    <label className="form-label">New Leads</label>
                                    <input
                                        type="number"
                                        value={currentEntry.newLeads}
                                        onChange={(e) => handleInputChange('newLeads', e.target.value)}
                                        className="form-input"
                                    />
                                </div>
                                <div>
                                    <label className="form-label">Active Trial Leads</label>
                                    <input
                                        type="number"
                                        value={currentEntry.activeTrialLeads}
                                        onChange={(e) => handleInputChange('activeTrialLeads', e.target.value)}
                                        className="form-input"
                                    />
                                </div>
                                <div>
                                    <label className="form-label">Texted</label>
                                    <input
                                        type="number"
                                        value={currentEntry.texted}
                                        onChange={(e) => handleInputChange('texted', e.target.value)}
                                        className="form-input"
                                    />
                                </div>
                                <div>
                                    <label className="form-label">Called</label>
                                    <input
                                        type="number"
                                        value={currentEntry.called}
                                        onChange={(e) => handleInputChange('called', e.target.value)}
                                        className="form-input"
                                    />
                                </div>
                                <div>
                                    <label className="form-label">Booked (Phone)</label>
                                    <input
                                        type="number"
                                        value={currentEntry.bookedPhone}
                                        onChange={(e) => handleInputChange('bookedPhone', e.target.value)}
                                        className="form-input"
                                    />
                                </div>
                                <div>
                                    <label className="form-label">Booked (Text)</label>
                                    <input
                                        type="number"
                                        value={currentEntry.bookedText}
                                        onChange={(e) => handleInputChange('bookedText', e.target.value)}
                                        className="form-input"
                                    />
                                </div>
                                <div>
                                    <label className="form-label">Conversions</label>
                                    <input
                                        type="number"
                                        value={currentEntry.conversions}
                                        onChange={(e) => handleInputChange('conversions', e.target.value)}
                                        className="form-input"
                                    />
                                </div>
                            </div>
                            <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                                <button onClick={addEntry} className="btn">
                                    ‚úì Save Entry
                                </button>
                                <button onClick={() => setShowForm(false)} className="btn btn-cancel">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    )}

                    <div className="view-tabs">
                        <button
                            onClick={() => setView('daily')}
                            className={`tab ${view === 'daily' ? 'active' : ''}`}
                        >
                            Daily View
                        </button>
                        <button
                            onClick={() => setView('weekly')}
                            className={`tab ${view === 'weekly' ? 'active' : ''}`}
                        >
                            Weekly View
                        </button>
                        <button
                            onClick={() => setView('monthly')}
                            className={`tab ${view === 'monthly' ? 'active' : ''}`}
                        >
                            Monthly View
                        </button>
                    </div>

                    {entries.length === 0 ? (
                        <div className="empty-state">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <h2 style={{ color: '#00A0DC' }}>No Entries Yet</h2>
                            <p style={{ fontSize: '1.1em' }}>Click "Add Daily Entry" to start tracking your performance!</p>
                        </div>
                    ) : (
                        <div style={{ overflowX: 'auto' }}>
                            <table className="data-table">
                                <thead>
                                    <tr>
                                        <th>{view === 'daily' ? 'Date' : 'Period'}</th>
                                        <th className="text-right">New Leads</th>
                                        <th className="text-right">Active Trial</th>
                                        <th className="text-right">Texted</th>
                                        <th className="text-right">Called</th>
                                        <th className="text-right highlight">Total Contacted</th>
                                        <th className="text-right">Phone</th>
                                        <th className="text-right">Text</th>
                                        <th className="text-right highlight">Total Booked</th>
                                        <th className="text-right conversion">Conversions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {view === 'daily' && entries.map((entry, idx) => (
                                        <tr key={idx}>
                                            <td>{new Date(entry.date).toLocaleDateString()}</td>
                                            <td className="text-right">{entry.newLeads}</td>
                                            <td className="text-right">{entry.activeTrialLeads}</td>
                                            <td className="text-right">{entry.texted}</td>
                                            <td className="text-right">{entry.called}</td>
                                            <td className="text-right highlight">
                                                {entry.newLeads + entry.activeTrialLeads}
                                            </td>
                                            <td className="text-right">{entry.bookedPhone}</td>
                                            <td className="text-right">{entry.bookedText}</td>
                                            <td className="text-right highlight">
                                                {entry.bookedPhone + entry.bookedText}
                                            </td>
                                            <td className="text-right conversion">{entry.conversions}</td>
                                        </tr>
                                    ))}
                                    {view === 'weekly' && weeklyData().map((week, idx) => (
                                        <tr key={idx}>
                                            <td style={{ fontWeight: 600 }}>{week.period}</td>
                                            <td className="text-right">{week.newLeads}</td>
                                            <td className="text-right">{week.activeTrialLeads}</td>
                                            <td className="text-right">{week.texted}</td>
                                            <td className="text-right">{week.called}</td>
                                            <td className="text-right highlight">{week.totalContacted}</td>
                                            <td className="text-right">{week.bookedPhone}</td>
                                            <td className="text-right">{week.bookedText}</td>
                                            <td className="text-right highlight">{week.totalBooked}</td>
                                            <td className="text-right conversion">{week.conversions}</td>
                                        </tr>
                                    ))}
                                    {view === 'monthly' && monthlyData().map((month, idx) => (
                                        <tr key={idx}>
                                            <td style={{ fontWeight: 600 }}>{month.period}</td>
                                            <td className="text-right">{month.newLeads}</td>
                                            <td className="text-right">{month.activeTrialLeads}</td>
                                            <td className="text-right">{month.texted}</td>
                                            <td className="text-right">{month.called}</td>
                                            <td className="text-right highlight">{month.totalContacted}</td>
                                            <td className="text-right">{month.bookedPhone}</td>
                                            <td className="text-right">{month.bookedText}</td>
                                            <td className="text-right highlight">{month.totalBooked}</td>
                                            <td className="text-right conversion">{month.conversions}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}

                    <div style={{ textAlign: 'center', padding: '40px 20px', color: '#0077B6', marginTop: '40px' }}>
                        <span style={{ color: '#FF6B35', fontSize: '1.5em' }}>üêæ</span>
                        <strong> SCENTHOUND</strong> - Making dog care routine, affordable, and accessible
                        <span style={{ color: '#FF6B35', fontSize: '1.5em' }}> üêæ</span>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<BowlerTracker />, document.getElementById('root'));
    </script>
</body>
</html>
